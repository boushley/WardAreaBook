<% #=================== Set Up ============================  -%>
<% ward_representative ||= false %>
<% family   ||=false %>
<% editable ||=false %>
<% hasAccessToEdit =false %>
<% isEditable = "" %>
<% isLate = "" %>
<% isClosed = "open-actions" %>
<% showDate = action_details.due_date %>

<% # Can the user edit this action?  -%>
<% if editable and (action_details.issuer_id == session[:user_id] or 
       action_details.person_id == session[:user_id]) 
       isEditable = "editable-action"
       hasAccessToEdit = true;
end %>

<% # Is the action late? %>
<% if (action_details.due_date < Date.today and 
       action_details.status == 'open')
       isLate = "late" 
end %>

<% # Is the action completed? %>
<% if action_details.status == 'closed'
  isClosed = "closed-actions" 
  showDate = action_details.updated_at.strftime("%b %d")
end %>

<% #=================== Code Content ============================  -%>

<% if ward_representative %>
  <%= link_to "#{action_details.person.full_name}", 
              {:controller =>'users', :action => 'todo', :id => action_details.person.id}, 
              :class=>"subtile-links" %> &#151;
<% end %> 

<div class = '<%= isClosed %> <%= isLate %>'>
  <% if family and action_details.family%>
    <%= link_to "#{action_details.family.head_of_house_hold} #{action_details.family.name}",
        family_path(action_details.family), :class=>"subtile-links" %> &#151;
  <% end %> 

  <div class='<%=isEditable%>' >
    <% if hasAccessToEdit %>
      <%= link_to_remote "#{action_details.action} (#{showDate})",
                          :url => {:controller => 'action_items', 
                                   :action => 'edit_remotely', 
                                   :id => action_details.id } %>
    <% else %>
      <%=h "#{action_details.action} (#{action_details.due_date})" %>
    <% end %>
  </div> <!-- IsEditable hover effects-->
</div> <!-- IsClosed (strike through) isLate (red)-->

<div id = 'action-item-comment-<%= action_details.id %>'> 
  <% if action_details.comment && action_details.comment.size > 0 %>
    &nbsp;&nbsp;(<%=h action_details.comment %>)
  <% end %>
</div> <!-- Action Comment -->
